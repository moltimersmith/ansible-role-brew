---
- name: Preflight | optionally require macOS
  ansible.builtin.assert:
    that:
      - ansible_system == 'Darwin'
    fail_msg: "brew role currently targets macOS (Darwin) hosts. ansible_system={{ ansible_system }}"
  when: brew_require_macos | bool

- name: Preflight | ensure brew is installed
  ansible.builtin.command: brew --version
  register: brew_version
  changed_when: false

- name: Update brew (optional)
  ansible.builtin.command: brew update
  when: brew_update | bool

- name: Ensure taps are present
  community.general.homebrew_tap:
    name: "{{ item }}"
    state: present
  loop: "{{ brew_taps }}"
  when: brew_taps | length > 0

- name: Ensure formulae are installed
  community.general.homebrew:
    name: "{{ brew_formulae }}"
    state: present
  when: brew_formulae | length > 0

- name: Ensure casks are installed
  community.general.homebrew_cask:
    name: "{{ brew_casks }}"
    state: present
  when: brew_casks | length > 0
